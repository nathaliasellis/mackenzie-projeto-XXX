<!DOCTYPE html>
<html>
	<head>
		
		<title>Magic Mirror</title>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="estilo.css"/>
		 <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.0/annyang.min.js"></script>	
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.0-rc.1/angular.min.js"></script>

		<script src="jquery.rss.min.js"></script>
	<!--	<script src="speech_api.js"></script>-->

	</head>
	<!-- <body onload=startclock() bgcolor="#EFEFEF"> -->
	<body onload=startclock()>
				<center>
					<script language="JavaScript">

						document.write("<font color='#000000' size='4' face='arial'>")
						var mydate=new Date()
						var year=mydate.getYear()
						if (year<2000)
						year += (year < 1900) ? 1900 : 0
						var day=mydate.getDay()
						var month=mydate.getMonth()
						var daym=mydate.getDate()
						if (daym<10)
						daym="0"+daym
						var dayarray=new Array("Domingo","Segunda-feira","Terça-feira","Quarta-feira","Quinta-feira","Sexta-feira","Sábado")
						var montharray=new Array(" de Janeiro de "," de Fevereiro de "," de Março de ","de Abril de ","de Maio de ","de Junho de","de Julho de ","de Agosto de ","de Setembro de "," de Outubro de "," de Novembro de "," de Dezembro de ")
						document.write("   "+dayarray[day]+", "+daym+" "+montharray[month]+year+" ")
						document.write("</b></i></font>")
					</script>	
				</center>
			
				<SCRIPT language=JavaScript>
					var timeID=null;
					var timerRunning=false;
					function stopclock (){
							if(timerRunning)
									clearTimeout(timerID);
							timerRunning=false;
							}
					function startclock (){
							stopclock ();
							//showtime ();
							timerID = setInterval("showtime()",1000);
							}
					function showtime() {
							var now=new Date();
							var hours= now.getHours();
							var minutes= now.getMinutes();
							var seconds= now.getSeconds();
							var timeValue=""+ hours;
							timeValue += ((minutes<10) ? ":0" : ":") + minutes
							timeValue += ((seconds<10) ? ":0" : ":") + seconds
					 
							document.clock.face.value= timeValue
							//timerID = setTimeout("showtime()",1000);
							timerRunning = true;
							}
				</SCRIPT>
				<script>
					jQuery(function($) {
						$("#rss-feeds").rss("http://pox.globo.com/rss/g1/",
						{
							entryTemplate:'<div>{date} <div style="color: #b31619; 	padding-left: -10%;">{title}</div></div></br>'
						},
						{dateLocale: 'pt-BR'},
						{dateFormat: 'MMMM DD, YYYY'}
						)
					})
				</script>
				<script>
					var app = angular.module("minhaPrevisao", []);

//Verifica se tem favorito salvo
if ((localStorage.estadoCache == undefined ) || (localStorage.cidadeCache == undefined )){
  estado = "SP";
  cidade = "São Paulo";
} else {
  estado = localStorage.estadoCache;
  cidade = localStorage.cidadeCache;
}

// Carrega dados
app.controller("myCtrlTemp", function($scope, $http){
  //Atualiza dados iniciais
  $http.get("http://developers.agenciaideias.com.br/tempo/json/"+cidade+"-"+estado).
  success(function(response){
    $scope.carregaPrevisao(response,cidade,estado);
	console.log(response);
  }).error(function(response){
    $scope.msg = "Não existem previsão do tempo para está cidade e estado";
    console.log(response);
  });

  //**** METODO ****
  //Nova consulta de previssão
  $scope.consultaPrevisao = function(){
    if(($scope.cidade == undefined)||($scope.estado == undefined)){
      $scope.msg = "Informe a cidade e estado para consultar a previsão do tempo.";
      $console.log($scope.msg);
    }
    else{
      $scope.carregaDados( $scope.cidade,$scope.estado);
      $scope.carregando = false;
    }
  }

  //**** METODO ****
  //Nova consulta ao clicar no botão consultar
  $scope.carregaDados = function(cidade,estado){
    $http.get("http://developers.agenciaideias.com.br/tempo/json/"+cidade+"-"+estado).
    success(function(response){
      $scope.carregaPrevisao(response,cidade,estado);
    }).error(function(response){
      $scope.msg = "Não existem previsão do tempo para está cidade e estado";
      console.log($scope.msg);
    });
  }

  //**** METODO ****
  // Atualiza Box Máximo e Mínima
  $scope.atualizaPrevisoes = function($scope, lista){
    var maxima = 0;
    var minima = 99;
    var dataMaxima;
    var dataMinima;

    for (var i = 0; i < lista.length; i++) {
      var dia = lista[i];
      // Temperatura Máxima
      if(dia.temperatura_max > maxima) {
        maxima = dia.temperatura_max;
        dataMaxima = dia.data;
      }
      // Temperatura Mínima
      if(dia.temperatura_min < minima) {
        minima = dia.temperatura_min;
        dataMinima = dia.data;
      }
    }
    $scope.max = maxima;
    $scope.dtMax = dataMaxima;
    $scope.min = minima;
    $scope.dtMin = dataMinima;
  }

  //**** METODO ****
  // Atualiza Box Recomendação verificando se
  // no proximos dias terá final de semnana e temperatura for > 25
  $scope.recomendacoes = function($scope, lista){

    //Limpa variavesi
    $scope.recomendacaoPositivo = "";
    $scope.recomendacaoNegativo = "";
    $scope.finalSemana = false;

    //Se dia atual for sábado
    if ($scope.copiaDiaSemana((lista[2].data)) == 'Sábado'){
      temperatura = lista[3].temperatura_max
      if(temperatura >= 25){
        $scope.recomendacaoPositivo = true;
        $scope.finalSemana = true;
      } else {
        $scope.recomendacaoNegativo = true;
        $scope.finalSemana = true;
      }
    }

    for (var i = 3; i < 7; i++) {
      var dia = "";
      var temperatura = 0;

      dia = lista[i].data;
      dia = $scope.copiaDiaSemana(dia);
      console.log(dia);

      if(dia == "Sábado"){
        temperatura = lista[i].temperatura_max;
        console.log(temperatura);
        if(temperatura >= 25){
          $scope.recomendacaoPositivo = true;
          $scope.finalSemana = true;
        } else {
          $scope.recomendacaoNegativo = true;
          $scope.finalSemana = true;
        }
      }
    }

    //Se não houver final de semana exibe mensagem.
    if($scope.finalSemana == false){
      $scope.semFinal = true;
    }
  }

  //**** METODO ****
  //Carrega Gráfico
  $scope.carregaGrafico = function($scope, lista){
    var areaChartCanvas = $("#areaChart").get(0).getContext("2d");
    var areaChart = new Chart(areaChartCanvas);

    var areaChartData = {
      labels: [$scope.copiaDiaSemana(lista[2].data), $scope.copiaDiaSemana(lista[3].data),$scope.copiaDiaSemana(lista[4].data), $scope.copiaDiaSemana(lista[5].data), $scope.copiaDiaSemana(lista[6].data)],
      datasets: [
        {
          label: "Electronics",
          fillColor: "rgba(210, 214, 222, 1)",
          strokeColor: "rgba(210, 214, 222, 1)",
          pointColor: "rgba(210, 214, 222, 1)",
          pointStrokeColor: "#c1c7d1",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(220,220,220,1)",
          data: [lista[2].temperatura_max, lista[3].temperatura_max,lista[4].temperatura_max, lista[5].temperatura_max, lista[6].temperatura_max] //Temperatura Máxima
        },
        {
          label: "Digital Goods",
          fillColor: "rgba(60,141,188,0.9)",
          strokeColor: "rgba(60,141,188,0.8)",
          pointColor: "#3b8bba",
          pointStrokeColor: "rgba(60,141,188,1)",
          pointHighlightFill: "#fff",
          pointHighlightStroke: "rgba(60,141,188,1)",
          data: [lista[2].temperatura_min, lista[3].temperatura_min,lista[4].temperatura_min, lista[5].temperatura_min, lista[6].temperatura_min] //Temperatura Mínima
        }
      ]
    };

    var areaChartOptions = {
      //Boolean - If we should show the scale at all
      showScale: true,
      //Boolean - Whether grid lines are shown across the chart
      scaleShowGridLines: true,
      //String - Colour of the grid lines
      scaleGridLineColor: "rgba(0,0,0,.05)",
      //Number - Width of the grid lines
      scaleGridLineWidth: 1,
      //Boolean - Whether to show horizontal lines (except X axis)
      scaleShowHorizontalLines: true,
      //Boolean - Whether to show vertical lines (except Y axis)
      scaleShowVerticalLines: true,
      //Boolean - Whether the line is curved between points
      bezierCurve: true,
      //Number - Tension of the bezier curve between points
      bezierCurveTension: 0.3,
      //Boolean - Whether to show a dot for each point
      pointDot: true,
      //Number - Radius of each point dot in pixels
      pointDotRadius: 4,
      //Number - Pixel width of point dot stroke
      pointDotStrokeWidth: 1,
      //Number - amount extra to add to the radius to cater for hit detection outside the drawn point
      pointHitDetectionRadius: 20,
      //Boolean - Whether to show a stroke for datasets
      datasetStroke: true,
      //Number - Pixel width of dataset stroke
      datasetStrokeWidth: 2,
      //Boolean - Whether to fill the dataset with a color
      datasetFill: true,
      //String - A legend template
      legendTemplate: "<ul class='chart-legend'><li><span style='background-color: #c1c7d1'></span>label1</li><li><span style='background-color: #3b8bba'></span>label1</li></ul>",
      //legendTemplate: "<ul class=\"<%=name.toLowerCase()%>-legend\"><% for (var i=0; i<datasets.length; i++){%><li><span style=\"background-color:<%=datasets[i].lineColor%>\"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>",
      //Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
      maintainAspectRatio: true,
      //Boolean - whether to make the chart responsive to window resizing
      responsive: true
    };
    //Create the line chart
    areaChart.Line(areaChartData, areaChartOptions);
  } // Fim Gráfico

   //**** METODO ****
  // Copia somente o nome da semana
  $scope.copiaDiaSemana = function(data){
    var dia = "";
    for (var i = 0; i < data.length; i++) {
      var str = "";
      var str = (data.charAt(i));
      dia = dia + str;
      if(str == ' ')
      break;
    }
    dia = dia.trim();
    return dia;
  }

  //**** METODO ****
  $scope.carregaPrevisao = function(previsao,cidade,estado){
    obj = $scope.myData = previsao;
    lista = $.map(obj, function(el) { return el });
    $scope.atualizaPrevisoes($scope,lista);
    $scope.recomendacoes($scope,lista);
    $scope.carregaGrafico($scope,lista);
    $scope.carregando = true;
    $scope.cidadeAtual = cidade;
    $scope.estadoAtual = estado;
  }
});
				</script>
				<script >
					// o que tem na js: ------
					// primeiro ativar o microfone
						window.addEventListener("DOMContentLoaded",function(){
										
							if(window.speechRecognition || window.webkitSpeechRecognition  || window.mozSpeechRecognition || window.msSpeechRecognition){

								//var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList
								//var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent

								//var words = [ 'desativar' , 'desativa' , 'remover', 'remove', 'apagar', 'apaga', 'limpar', 'limpa', 'notícias', 'notícia', 'clima', 'previsão', 'tempo', 'trânsito', 'congestionamento' ];
								//var grammar = '#JSGF V1.0; grammar words; public <word> = ' + words.join(' | ') + ' ;'

								// instanciar objeto da api:
								var recebe_audio = new (window.SpeechRecognition || window.webkitSpeechRecognition || window.mozSpeechRecognition || window.msSpeechRecognition)();
								//var speechRecognitionList = new SpeechGrammarList();
								//speechRecognitionList.addFromString(grammar, 1);

								// gravação contínua ----
								recebe_audio.continuous =true;
								// especifica se resultado final pode ser alterado----
								//recebe_audio.interimResults=false;
								recebe_audio.interimResults=true;
								recebe_audio.lang = "pt-BR";
								recebe_audio.maxAlternatives = 1;
/*
								// comandos para mostrar ou esconder cada widget
								var commands = {
									'noticias': function() {
										window.alert("NOTICIAS");
										document.getElementById("noticia").style.display = "block";
									},
									'clima': function() {
										document.getElementById("clima").style.display = "block";
									},
								'transito': function() {
								  document.getElementById("transito").style.display = "block";
								}
							};
							// Add our commands to annyang
							annyang.addCommands(commands);
*/

							recebe_audio.start();

							// capta o resultado da gravação do audio
							recebe_audio.onresult= function(event){
								//console.log(event.results[0][0].transcript);
								
								var last = event.results.length - 1;
								var cmdArray = event.results[last];
								
								//for(var cntRslts = 0; cntRslts < event.results.length; cntRslts++) {
								
									//var cmdArray = event.results[cntRslts];
									
									for(var cmdCnt = 0; cmdCnt < cmdArray.length; cmdCnt++) {
														
										if(cmdArray) {
											
											var command = cmdArray[cmdCnt].transcript.trim().toLowerCase();
											console.log(command);
											$('.transcription').text(command);
											
											//if(command === 'desativar' || command === 'desativa' 
											//	|| command === 'remover' || command === 'remove' 
											//	|| command === 'apagar'  || command === 'apaga'  
											//	|| command === 'limpar' || command === 'limpa' ) {
											//		document.getElementById("rss-feeds").style.display = "none";
											//		document.getElementById("clima").style.display = "none";
											//		document.getElementById("transito").style.display = "none";
											//}
											//
											//if(command === 'notícias' || command === 'notícia'){
											//	
											//	document.getElementById("rss-feeds").style.display = "block";
											//	
											//} else if (command === 'clima' || command === 'previsão' ||command === 'tempo'){
											//
											//	document.getElementById("clima").style.display = "block";
											//	
											//} else if (command === 'trânsito' || command === 'congestionamento'){
											//
											//	document.getElementById("transito").style.display = "block";
											//	
											//}
											
											if(command.indexOf('desativar') >= 0 || command.indexOf('desativa') >= 0
												|| command.indexOf('remover') >= 0 || command.indexOf('remove') >= 0
												|| command.indexOf('apagar') >= 0  || command.indexOf('apaga') >= 0
												|| command.indexOf('limpar') >= 0 || command.indexOf('limpa') >= 0 ) {
													document.getElementById("rss-feeds").style.display = "none";
													document.getElementById("clima").style.display = "none";
													document.getElementById("transito").style.display = "none";
											}
											
											if(command.indexOf('notícias') >= 0 || command.indexOf('notícia') >= 0){
												
												document.getElementById("rss-feeds").style.display = "block";
												
											} else if (command.indexOf('clima') >= 0 || command.indexOf('previsão') >= 0 ||command.indexOf('tempo') >= 0){
											
												document.getElementById("clima").style.display = "block";
												
											} else if (command.indexOf('trânsito') >= 0 || command.indexOf('congestionamento') >= 0){
											
												document.getElementById("transito").style.display = "block";
												
											} /*else if (command.indexOf('agenda') >= 0 || command.indexOf('compromissos') >= 0){
											
												document.getElementById("agenda").style.display = "block";
												
											} */else if (command.indexOf('roupa') >= 0 || command.indexOf('roupas') >= 0){
											
												document.getElementById("estilo").style.display = "block";
												
											} 
										}
									}
								//}
							};		
							
							recebe_audio.onnomatch = function(event) {
								console.log('No Match!');
							}
							
							recebe_audio.onspeechend = function() {
								console.log('Speech has stopped being detected');
							}
							
							recebe_audio.onerror = function(event) {
								console.log('Speech recognition error detected: ' + event.error);
							}

							recebe_audio.onended = function(event) {
								recebe_audio.start();
							}			
						};
						});
				</script>
				<!--<script type="text/javascript">
					$(document).ready(function () {
										 
						$.get('https://query.yahooapis.com/v1/public/yql',{
							q:'select * from weather.forecast where woeid in (455827)',
							format:'json'
						},function (res) {
							if(res){
								console.log(res);
								umi = res.query.results.channel.atmosphere.humidity;
								high = res.query.results.channel.item.forecast[0].high;
								low = res.query.results.channel.item.forecast[0].low;
								high = Math.round((high-32)/1.8); //F to C
								low = Math.round((low-32)/1.8); //F to C
								
								console.log(high,low,umi);
								
							/*	if(high>25 && low<21){
									console.log("leva o casaco nene");
									document.getElementById("myimg"). innerHTML = "mangaCurta2.jpg";
								
								}else if(high<21){
									console.log("leva o cobertor , melhor");
									document.getElementById("estilo").innerHTML = "leva o cobertor , melhor";
								}else{
									document.getElementById("estilo").innerHTML = "oi nene";
									document.getElementById("imgCurta").innerHTML = "C:\Users\Usuário\Documents\Mackenzie\TCC\outubro\MangaCurta\mangaCurta2.jpg";
								}
									
								*/
								
							}
						},'json');
											 
						
					});
				</script>-->
		<FORM name=clock onsubmit=0>
			<DIV align="center"><INPUT type=button value="" name=face></DIV>
		</FORM>
				
			<p class="border">
				<div class = "previsao" id="clima">
					<iframe allowtransparency="true" 
							marginwidth="0" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="no" 
							src="https://www.cptec.inpe.br/widget/widget.php?p=244&w=v&c=d2ceeb&f=ffffff" 
							height="320px" width="182px">q''''
					</iframe>						
				</div>
				
				<div id="transcription"></div>

				
				<div class="noticia" id="rss-feeds" ></div>
				
				<div class = "transito" id="transito">
					<iframe 
						src="https://embed.waze.com/iframe?zoom=12&lat=45.6906304&lon=-120.810983"
						width="300" height="400">
					</iframe>
				</div>
				
				<div class = "agenda" id="agenda">
					<iframe src="https://calendar.google.com/calendar/embed?src=nathalia.ssellis%40gmail.com&ctz=America%2FSao_Paulo"
						style="border: 0" width="300" height="600" frameborder="0" scrolling="no"/>
					<iframe src="https://calendar.google.com/calendar/embed?showNav=0&amp;showPrint=0&amp;showTabs=0&amp;showCalendars=0&amp;showTz=0&amp;mode=AGENDA&amp;height=600&amp;wkst=2&amp;bgcolor=%23FFFFFF&amp;src=nathalia.ssellis%40gmail.com&amp;color=%231B887A&amp;src=%23contacts%40group.v.calendar.google.com&amp;color=%2329527A&amp;src=pt.brazilian%23holiday%40group.v.calendar.google.com&amp;color=%2329527A&amp;ctz=America%2FSao_Paulo"
						style="border-width:1" width=250" height="1000" frameborder="0" scrolling="no">
					</iframe>
				</div>
				<div class="estilo" id="estilo">
					<img id="imgCurta" class="imgCurta" src="C:\Users\Usuário\Documents\Mackenzie\TCC\outubro\MangaCurta\curta1.jpg" width="107" height="98"/>
				</div>
				
			</p>		
			</body>
	
		</html>
	
